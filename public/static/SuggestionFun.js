var userUploadFun=null;var _ulPhotoes=null;$(function(){var c=function(){var f="意见或建议",n=10;var l=$("#hidPicAll");_ulPhotoes=$("#ulPhotoes");var g=new RegExp("[`~@#$^&*=|{}':\\[\\].+￥%<>/~！#￥…（）—|{}【】》‘：']");var h=new RegExp("[`~#$^&*()=|{}':\\[\\]+￥%<>/~！#￥…（）|{}【】。》‘：']");var j=function(){var p=0;var u=$("#liUplodTxt");var t=$("#liUplodFile");var s=$("#pageForm");var v=$("#upload");var r="https://file.1yyg.net/userSuggest/";v.bind("change",function(A){stopBubble(A);var x=l.val().split(",").length;if(x>=n){b("最多只能上传十张图片");return false}var z=$(this);var B=z.val();if(B!=""){var y=(B.substr(B.length-5)).substr((B.substr(B.length-5)).indexOf(".")+1).toLowerCase();if(y!="gif"&&y!="jpg"&&y!="jpeg"&&y!="bmp"&&y!="png"){z.val("");b("请上传jpg、jpeg、gif、png或bmp图片",285);return false}var w='<li id="liTmp">    <div class="inner">        <img id="imgTmp" src="https://skin.1yyg.net/images/loading2.gif?v=160722" alt="">    </div>    <a id="aTmp" class="img-clear" style="display:none"></a></li>';_ulPhotoes.prepend(w);s.prop("action","SuggestUpLoadImg.do?action=upload").prop("target","upFrame");s.submit();z.val("")}else{b("请先选择需要上传的文件");return false}});var q=function(){this.ShowUploadPic=function(z){var w=l.val();if(w.indexOf(z)<0){w+=(w==""?"":",")+z;l.val(w);var x=r+z;var A=z.split(".")[0];var D=_ulPhotoes.find("#liTmp"),B=_ulPhotoes.find("#imgTmp"),E=_ulPhotoes.find("#aTmp");D.prop("id","li"+A);B.prop("id","img"+A).prop("src",x);E.prop("id","del"+A).css("display","block");p++;if(p>0){u.hide();if(p>=n){t.hide()}}var y=_ulPhotoes.find("#del"+A),C=_ulPhotoes.find("#li"+A);y.click(function(){var F=function(){s.prop("action","SuggestUpLoadImg.do?action=del&filename="+z).prop("target","upFrame");s.submit();C.remove();var G=l.val();if(G.indexOf(z)!=-1){G=(","+G+",").replace(","+z+",",",");l.val(G.substr(1,G.length-2));p--;if(p<n){t.show();if(p==0){u.show()}}}};a("您确定删除吗？",F)})}else{return false}};this.ShowUploadErr=function(w){b(w)}};userUploadFun=new q()};j();var m=function(q){var p=/^0\d{2,3}-?\d{7,8}$/;return p.test(q)};var i=function(q){var p=/^1\d{10}$/;return p.test(q)};var o=function(q){var p=/^([a-zA-Z0-9._-])+@([a-zA-Z0-9])+((\.[a-zA-Z0-9-]{2,3}){1,2})$/;return p.test(q)};var k=function(q){var p=/^[1-9][0-9]{5,15}$/;return p.test(q)};var e=function(){var u=function(z){var y=/^[\u4e00-\u9fa5]+$/;return y.test(z)};var q=$("#txtContent"),x=$("#txtContact"),v="",w="",r="",p=$("#btnSubmit");var t=function(B,A){var y="";for(var z=0;z<B.length;z++){if(A==0){y+=B.substr(z,1).replace(g,"")}else{y+=B.substr(z,1).replace(h,"")}}return y};var s=false;p.click(function(){if(s){return}v=q.val().replace(/\||/g,"");if(v==""){b("请输入"+f);return false}if(g.test(v)){b("输入内容不能包含特殊字符");return false}if(v.length>200){b("内容不能超过200字");return false}v=t(v,0);v+=" || weixin";w=x.val();if(w!=""){if(!m(w)&&!i(w)&&!o(w)&&!k(w)){b("联系方式请输电话、手机、QQ或Email");return false}if(w.length>20){b("联系方式最多20个字符");return}}f+="(wx)";s=true;r=l.val();if(r!=""){v=v+" || "+r}var y=function(){return"type="+f+"&content="+v+"&info="+w};GetJPData("","insertCmMessage",y(),function(z){if(z.code==0){d("提交成功",setTimeout(function(){location.href="Help.do"},1000))}else{if(z.code==-1){b("提交的内容不能为空")}else{if(z.code==2){b("提交的内容不能超过200字")}else{if(z.code==3){b("联系方式不能超过20字")}else{b("提交失败，请稍后再试")}}}}s=false})})};e();$("#ulType").find("li").on("click",function(){$(this).addClass("checked").siblings().removeClass("checked");f=$(this).find(".gray6").html();if(f==""){f="意见或建议"}$("#txtContent").attr("placeholder","请输入您的"+f)});FastClick.attach(document.body)};var b=function(e){$.PageDialog.fail(e)};var a=function(f,e){$.PageDialog.confirm(f,e,126)};var d=function(f,e){$.PageDialog.ok(f,e)};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160907",function(){Base.getScript(Gobal.Skin+"/JS/fastclick.js?v=160907",c)})});function UploadFileScriptAPI(b,a){if(b!=""){_ulPhotoes.find("#liTmp").remove();userUploadFun.ShowUploadErr(b)}else{userUploadFun.ShowUploadPic(a)}};