$(function(){if(!Gobal.IsWeixin){$("body").addClass("m-site-box")}var a=function(){var e=120;var c=20;var b=0;var l=0;var m=false;var r=new Object();var o=[];var w=$("#hidSearchKey").val(),t=$("#spCount"),n=$(".goodList"),q=$("#ulGoodsList"),f=$("#divNoneData"),s=$("#divLoading"),v=$("#ulRec"),p=$("#divResultTip");var j="";var d=new $CartComm();var g=function(y){$.PageDialog('<div class="Prompt">'+y+"</div>",{W:150,H:45,close:false,autoClose:true,submit:function(){location.reload()}})};var x=function(y){$.PageDialog.fail(y)};var h=function(y){$.PageDialog.ok(y)};var k=function(F,z,A,y,H){var B=255;var E=126;if(typeof(y)!="undefined"){B=y}if(typeof(y)!="undefined"){E=H}var G=null;var I='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+F+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var D=function(){var J=$("#pageDialog");J.find("a.z-DefineBtn").click(function(){if(typeof(z)!="undefined"&&z!=null){z()}C.close()});J.find("a.z-CloseBtn").click(function(){if(typeof(A)!="undefined"&&A!=null){A()}C.cancel()})};var C=new $.PageDialog(I,{W:B,H:E,close:true,autoClose:false,ready:D})};var i=function(){var A=function(F,E,D){F.addClass("add");d.addShopCart(E,D,function(G){if(G.code==0){addNumToCartFun(G.num);h("添加成功")}else{if(G.code==1){if(G.num==0){g("啊哦~！被抢光啦！")}else{var K=F.parent().parent().parent();var I=G.str;if(I!=""){var M=I.split("|");if(M!=null&&M.length==6){var J=function(){F.attr("codeid",M[0]);K.find("em.gray9").html("价值：￥"+CastMoney(M[3])+".00");K.find("span.pgbar").attr("style","width:"+M[5]+"%");K.find(".P-bar01").find("em").html(M[2]);K.find(".P-bar02").find("em").html(M[3]);K.find(".P-bar03").find("em").html(M[4])};var H=function(){J();A(F,M[0],D)};var L=function(){J()};k("本云已满员，是否云购下一云？",H,L)}}else{x("本商品已结束");K.find("span.pgbar").attr("style","width:100%");K.find(".P-bar01").find("em").html(K.find(".P-bar02").find("em").html());K.find(".P-bar03").find("em").html("0")}}}else{if(G.code==2){x("哎呀！购物车满啦，删除一些吧！",300)}else{x("添加失败，请重试["+G.code+"]")}}}F.removeClass("add")})};var z=function(D){if(D==0){return"key="+encodeURIComponent(w.replace(/(\/)/g,""))+"&orderFlag=10&quantity="+e}else{return"sortID=0&brandID=0&orderFlag=10&FIdx=1&EIdx=8&isCount=0"}};var y=function(){GetJPData("","GetRecGoodList",z(1),function(K){m=false;if(K.code==0){var G=K.listItems,N=G.length;var H,F="",J="",E;var L=0,O=0,D=0,P=0;for(var I=0;I<N;I++){H=G[I];L=parseInt(H.codeSales);O=parseInt(H.codeQuantity);D=parseInt(O-L);P=parseInt(L*100)/O;P=L>0&&P<1?1:P;J="";if(H.codeType==10){J='<div class="pTitle pPurchase">限购</div>'}E="";if(D==0){E="unAdd"}F='<li id="'+H.goodsID+'">    <a href="javascript:;" class="g-pic">        <img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+H.goodsPic+'" width="136" height="136" />'+J+'    </a>    <p class="g-name">(第'+H.codePeriod+"云)"+H.goodsSName+'</p>    <ins class="gray9">价值:￥'+H.codePrice+'.00</ins>    <div class="btn-wrap">        <div class="Progress-bar">            <p class="u-progress">                <span class="pgbar" style="width: '+P+'%;"><span class="pging"></span></span>            </p>        </div>        <div class="gRate">            <a codeid="'+H.codeID+'" class="'+E+'"><s></s></a>        </div>    </div></li>';var M=$(F);M.click(function(){location.href="/"+Gobal.SiteVer+"/products/"+$(this).attr("id")+".do"}).find("div.gRate").find("a").click(function(R){stopBubble(R);var Q=$(this);if(!Q.hasClass("unAdd")){A(Q,Q.attr("codeid"),1)}});v.append(M)}loadImgFun(0)}})};var C=function(L){l=L.length>e?e:L.length;t.html(l);var I=0,J=0,K=0,R=0;var O,E,G,M,P,S="",F="";var U=[];var N=[];for(var Q=0;Q<l;Q++){O=L[Q];I=parseInt(O.codeSales);J=parseInt(O.codeQuantity);K=parseInt(J-I);R=parseInt(I*100)/J;R=I>0&&R<1?1:R;G="";if(O.goodsTag==10){G='<div class="pTitle pPurchase">限购</div>'}M="";P=O.isSale==1;if(K==0||!P){M="unAdd"}S="";var D=O.goodsSName;if(!P){S="is-end";F='<div class="tip">已结束</div>'}else{F='        <div class="gRate">            <div class="Progress-bar">                <p class="u-progress"><span style="width: '+R+'%;" class="pgbar"><span class="pging"></span></span></p>                <ul class="Pro-bar-li">                    <li class="P-bar01"><em>'+I+'</em>已参与</li>                    <li class="P-bar02"><em>'+J+'</em>总需人次</li>                    <li class="P-bar03"><em>'+K+'</em>剩余</li>                </ul>            </div>            <a codeid="'+O.codeID+'" class="'+M+'"><s></s></a>        </div>';D="(第"+O.codePeriod+"云)"+D;U.push(O.codeID);N.push(K)}E='<li id="'+O.goodsID+'" class="'+S+'">    <span class="gList_l fl">        <img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+O.goodsPic+'" />'+G+'    </span>    <div class="gList_r">        <h3 class="gray6">'+D+'</h3>        <em class="gray9">价值：￥'+CastMoney(O.codePrice)+"</em>"+F+"    </div></li>";var T=$(E);T.click(function(){location.href="/"+Gobal.SiteVer+"/products/"+$(this).attr("id")+".do"}).find("div.gRate").find("a").click(function(W){stopBubble(W);var V=$(this);if(!V.hasClass("unAdd")){A(V,V.attr("codeid"),1)}});q.append(T);loadImgFun(0)}if(U.length>0){var H=false;$("#multipleAddToCartBtn").on("click",function(){if(H===true){return false}H=true;d.addBatchShopCart(U.join(","),N.join(","),function(V){if(V>0){var X=null;var W='<div class="m-add-wrapper"><div class="m-add-info"><p class="m-add-tips gray3"><strong class="orange">'+V+'</strong>&nbsp;个商品已成功添加到购物车</p><div class="u-Btn"><div class="u-Btn-li"><a id="a_cancle" href="javascript:;" class="z-CloseBtn">再看看</a></div><div class="u-Btn-li"><a href="'+Gobal.WxDomain+"/"+Gobal.SiteVer+'/mycart/" class="z-DefineBtn">去购物车</a></div></div></div><div class="dialog-close"></div></div>';var Y=function(){$("div.dialog-close,a.z-CloseBtn").click(function(){X.cancel()})};X=new $.PageDialog(W,{W:300,H:119,autoClose:false,ready:Y,isTop:false})}else{x("添加失败！")}H=false})}).show()}};var B=function(){if(m){return}m=true;s.show();GetJPData("https://search.1yyg.com","getSearchList",z(0),function(D){m=false;if(D.code==0){C(D.listItems);p.show();n.show();f.hide()}else{p.hide();n.hide();f.show();y()}s.hide()})};B()};if(document.location.hash!=="#sbox"){i()}var u=function(){var A=15;var y=new RegExp("[`~@#$^&*=|_{}()':\\[\\].+￥%<>/~！#￥…（）—|{}【】‘：']");var z=$("#divSearch"),F=z.find("input"),B=$(".history");if(w!=""){F.val(w)}var G={boxShow:function(){z.addClass("focus-box");$(".search-info").show();$(".good-result").hide()},boxHide:function(){z.removeClass("focus-box");$(".search-info").hide();$(".good-result").show()},setHash:function(){if(document.location.hash==""){this.boxHide();F.blur()}else{if(document.location.hash="#sbox"){this.boxShow()}}}};if(document.location.hash==="#sbox"){G.boxShow()}F.on("focus",function(){document.location.hash="#sbox";$(".search-info").show();$(".good-result").hide()});$(window).on("hashchange",function(){G.setHash()});Array.prototype.remove=function(I){var H=this.indexOf(I);if(H>-1){this.splice(H,1)}};var E={searchData:[],add:function(H){if(H==null||H==undefined||H==""){return}this.del(H);var I="";this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){I=H+","+this.searchData;this.searchData=I.split(",");if(this.searchData.length>A){this.searchData.splice(A,1)}I=this.searchData.toString()}else{I=H}window.localStorage.setItem("searchData",I)},del:function(I){this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){var H=this.searchData.split(",");if(H.length>0&&H.indexOf(I)>-1){H.remove(I);window.localStorage.setItem("searchData",H.toString())}}},clear:function(){delete localStorage.searchData},get:function(){this.searchData=window.localStorage.searchData},fresh:function(L){this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){var H=this.searchData.split(","),I="",M='<ul class="his-list thin-bor-top">',K="";for(var J=0;J<H.length;J++){K+='<li wd="'+H[J]+'" class="thin-bor-bottom"><a class="items">'+H[J]+"</a></li>"}if(K!=""){I=M+K+"</ul>";I+='<div class="cle-cord thin-bor-bottom" id="btnClear">清空历史记录</div>';L.on("click","li",function(){var O=$(this),N=O.attr("wd");E.add(N);E.fresh(L);location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+N});L.on("click","#btnClear",function(){E.clear();E.fresh(L)});L.html(I);B.show()}}else{L.html("");B.hide()}}};var D=$("#divSearchHotHistory"),C=$("#btnClearInput");E.fresh(D);$("#ulSearchHot").on("click","li",function(){var I=$(this),H=I.attr("wd");E.add(H);F.val(H);location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+H});$("#btnSearch").click(function(){var H=F.val();E.add(H);if(H==""){H="汽车"}F.val(H);location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+H});F.bind("input",function(){if($(this).val()==""){C.hide()}else{C.show()}});C.bind("click",function(){F.val("").focus();$(this).hide()});if(F.val()!=""){C.show()}};u();Gobal.scrollChangeFastNav()};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/fastclick.js?v=160523",function(){Base.getScript(Gobal.Skin+"/JS/CartComm.js?v=160523",a)})})});