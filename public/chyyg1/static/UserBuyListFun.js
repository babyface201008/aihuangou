$(function(){var f=null;var d=$("#divLoading");var c=$("#ul_list");var g=20;var a={FIdx:1,EIdx:g,isCount:1};var b=0;var e=function(){var m=new $CartComm();var i=function(n){$.PageDialog.fail(n)};var l=function(n){$.PageDialog.ok(n)};var h=function(u,o,p,n,w){var q=255;var t=126;if(typeof(n)!="undefined"){q=n}if(typeof(n)!="undefined"){t=w}var v=null;var x='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+u+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var s=function(){var y=$("#pageDialog");y.find("a.z-DefineBtn").click(function(){if(typeof(o)!="undefined"&&o!=null){o()}r.close()});y.find("a.z-CloseBtn").click(function(){if(typeof(p)!="undefined"&&p!=null){p()}r.cancel()})};var r=new $.PageDialog(x,{W:q,H:t,close:true,autoClose:false,ready:s})};var k=function(p,o,q,n){p.addClass("add");m.addShopCart(o,1,function(r){if(r.code==0){l("添加成功")}else{if(r.code==2){i("哎呀！购物车满啦，删除一些吧！",300)}else{i("添加失败，请重试["+r.code+"]")}}p.removeClass("add")},n)};var j=function(){var n=function(){return"FIdx="+a.FIdx+"&EIdx="+a.EIdx+"&isCount="+a.isCount+"&state=-1"};var o=function(){d.show();GetJPData("","getUserBuyList",n(),function(x){if(x.code==0){if(a.isCount==1){b=x.count;a.isCount=0}var u=x.listItems;var z=u.length;var A=0;var B=0;var q=0;var C=0;for(var y=0;y<z;y++){var p=u[y];var r=parseInt(p.codeState);var v=parseInt(p.newCodeID);var s="";var w=0;if(r==1){A=parseInt(p.codeSales);B=parseInt(p.codeQuantity);q=parseInt(B-A);C=parseInt(A*100)/B;C=A>0&&C<1?1:C;w=q;if(p.codeType==3){w=p.codeLimitBuy>=q?q:p.codeLimitBuy}s+='<li codeID="'+p.codeID+'" class="in_progress">';s+='<div class="in_info">';s+='<cite><img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+p.goodsPic+'" /><i>进行中</i>'+(p.codeType==3?'<div class="pPurchase">限购</div>':"")+"</cite>";s+="<dl>";s+="<dt>(第<em>"+p.codePeriod+"</em>云)"+p.goodsName+"</dt>";s+="<dd>";if(p.codeType==3){s+='限购<em class="orange">'+p.codeLimitBuy+"</em>人次 / "}s+='您已参与<em class="orange">'+p.buyNum+"</em>人次</dd>";s+="<dd>";s+='<div class="gRate short">';s+='<div class="Progress-bar">';s+='<p class="u-progress"><span style="width:'+C+'%;" class="pgbar"><span class="pging"></span></span></p>';s+='<ul class="Pro-bar-li">';s+='<li class="P-bar01"><em>'+A+"</em>已参与</li>";s+='<li class="P-bar02"><em>'+B+"</em>总需人次</li>";s+='<li class="P-bar03"><em>'+q+"</em>剩余</li>";s+="</ul>";s+="</div>";s+="</div>";s+="</dd>";s+="</dl>";s+="</div>";s+='<a href="javascript:" newCodeID="'+p.codeID+'" codeState="'+r+'" canbuy="'+w+'" class="z-set-wrap"><s class="z-set"></s></a>';s+="</li>"}else{if(r==2){s+='<li codeID="'+p.codeID+'" class="in_progress">';s+='<div class="in_info">';s+='<cite><img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+p.goodsPic+'" /><i>已满员</i>'+(p.codeType==3?'<div class="pPurchase">限购</div>':"")+"</cite>";s+="<dl>";s+="<dt>(第"+p.codePeriod+"云)"+p.goodsName+"</dt>";s+='<dd>您已参与<em class="orange">'+p.buyNum+"</em>人次</dd>";s+='<dd><span class="z-announced-btn">正在揭晓<span class="dotting"></span></span></dd>';if(v>0){s+='<dd class="orange"><a href="'+Gobal.SiteVer+"/lottery/detail-"+v+'.do">第<em>'+p.newCodePeriod+'</em>云进行中<span class="dotting"></span></a></dd>'}s+="</dl>";s+="</div>";if(v>0){s+='<a href="javascript:" newCodeID="'+v+'" codeState="'+r+'"  class="z-set-wrap"><s class="z-set"></s></a>'}s+="</li>"}else{if(r==3){s+='<li codeID="'+p.codeID+'">';s+='<cite><a href="goodsbuydetail-'+p.codeID+'.do"><img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+p.goodsPic+'" /></a><i>已揭晓</i>'+(p.codeType==3?'<div class="pPurchase">限购</div>':"")+"</cite>";s+="<dl>";s+='<dt><a href="goodsbuydetail-'+p.codeID+'.do" class="gray6">(第'+p.codePeriod+"云)"+p.goodsName+"</a></dt>";s+='<dd>获得者：<a href="/'+Gobal.SiteVer+"/userpage/"+p.userWeb+'" class="blue">'+p.userName+"</a></dd>";s+="<dd>揭晓时间：<em>"+p.codeRTime+"</em></dd>";if(v>0){s+='<dd class="orange"><a href="'+Gobal.SiteVer+"/lottery/detail-"+v+'.do">第<em>'+p.newCodePeriod+'</em>云进行中<span class="dotting"></span></a></dd>'}s+="</dl>";if(v>0){s+='<a href="javascript:" newCodeID="'+v+'" codeState="'+r+'" class="z-set-wrap"><s class="z-set"></s></a>'}s+="</li>"}}}var t=$(s);t.click(function(){location.href="goodsbuydetail-"+$(this).attr("codeID")+".do"}).find("a.z-set-wrap").click(function(E){try{stopBubble(E);_czc.push(["_trackEvent","微信云购记录","点击","加入购物车","",""])}catch(E){}var D=$(this);if(!D.hasClass("unAdd")){k(D,D.attr("newCodeID"),D.attr("codeState"),D.attr("canBuy"))}});c.append(t)}if(a.EIdx<b){_IsLoading=false}else{d.hide();if(b>0){c.append(Gobal.LookForPC)}}loadImgFun(0)}else{if(x.code==-1){if(a.FIdx==1){$("body").removeClass("g-acc-bg");c.html('<div class="noRecords colorbbb clearfix"><s class="z-y8"></s>最近还没有参与云购？<br> 梦想与您只有1元的距离！~</div>');window.GuessListBox.webRender($("div.noRecords"),"after")}d.hide()}else{d.hide();c.html(Gobal.ErrorHtml(x.code));_IsLoading=false}}})};this.getFirstPage=function(){o()};this.getNextPage=function(){a.FIdx+=g;a.EIdx+=g;o()}};f=new j();f.getFirstPage();scrollForLoadData(f.getNextPage);Gobal.scrollChangeFastNav()};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/GuessGoodsFun.js?v=17011002",e)})});