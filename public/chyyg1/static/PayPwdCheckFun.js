var Wx=Wx||{};Wx.PayPwdCheckFun={passportUrl:"https://passport.1yyg.com",identityVal:null,identityType:null,codeObj:null,isOpen:null,switchObj:null,isUpate:null,$btnSendMsg:$("#btnSend"),$btnSubmit:$("#btnSubmit"),codeErr:{Empty:"请输入验证码",LenErr:"验证码长度不对吧",Err:"验证码错误或过期"},isDigitLetter:function(b){var a=/^[0-9a-zA-Z]{6,}$/;return a.test(b)},FailDialog:function(a){$.PageDialog.fail(a)},OKDialog:function(b,a){$.PageDialog.ok(b,a)},isLoaded:true,hidIdentity:"",init:function(){var a=this;a.identityVal=$("#hidIdentity").val();a.identityType=$("#hidIdentityType").val();a.codeObj=$("#txtCode");a.isOpen=$("#hidIsOpen").val()=="1"?true:false;a.switchObj=$("#a_switch");a.isUpate=$("#hidIsUpdate").val()=="1"?true:false;if(a.isUpate){$("#div_auth").show()}else{a.switchObj.show()}a.switchObj.bind("click",function(){if(a.switchObj.hasClass("open-pay")){$(this).removeClass("open-pay")}else{$(this).addClass("open-pay")}$("#div_update").toggle();$("#div_auth").toggle()});a.codeObj.bind("keydown",function(c){var b=(window.event)?event.keyCode:c.keyCode;if(b==32){return false}else{if(b==13){return false}}return true});a.hidIdentity=$("#hidIdentity").val();a.vcCodeEvtReg();a.$btnSubmit.click(function(){a.submitSaveData()})},closeUserPayPwdFun:function(b){var a=this;if(a.isUpate){location.href="PayPwdSet.do?sn="+b+"&forward="+$("#hidForward").val()}else{GetJPData("","CloseUserPayPwdByUserID","",function(c){if(c.code==0){a.OKDialog("关闭成功！",function(){location.href="SafeSettings.do"})}else{if(c.code==10){location.reload()}else{a.FailDialog("关闭失败，请重试["+c.code+"]！")}}})}},vcCodeEvtReg:function(){var a=this;var b={before:function(){return a.beforeShowDialog.apply(a)},startEvt:function(){return true},key:function(){return a.identityVal},isHttps:true,clickSuccess:function(){a.$btnSubmit.attr("class","orgBtn");a.sendMsgInterval()},cancelDialogCallback:function(){a.isLoaded=true;a.$btnSendMsg.attr("class","orgBtn")}};a.$btnSendMsg.vcCode4Mobile(b)},beforeShowDialog:function(){var a=this;if(a.$btnSendMsg.hasClass("orgBtn")){return true}return false},interval:null,timeSpan:120,sendMsgInterval:function(){var c=this;if(!c.$btnSendMsg.hasClass("grayBtn")){c.$btnSendMsg.attr("class","grayBtn").html("正在发送");var b=function(){var d=function(){c.timeSpan--;if(c.timeSpan>0){c.$btnSendMsg.html("重新发送("+c.timeSpan+")")}else{c.resetFun()}};c.interval=setInterval(d,1000)};var a=function(){c.$btnSendMsg.attr("class","orgBtn").html("重新发送")};c.sendMsg(b,a)}},resetFun:function(){var a=this;a.timeSpan=120;clearInterval(a.interval);a.interval=null;a.$btnSendMsg.attr("class","orgBtn").html("重新发送");$.vcCode4Mobile.options.isVcCodeValidated=false;$.vcCode4Mobile.options.isDragEnabled=true},sendMsg:function(b,a){var c=this;if(c.identityType=="0"){GetJPData(c.passportUrl,"sendMsgVcCode","userMobile="+c.identityVal+"&auth="+$.vcCode4Mobile.options.authstr,function(d){if(d.state==0){b();c.OKDialog("手机验证短信已发送！");c.$btnSubmit.attr("class","orgBtn")}else{if(d.state==2){a();c.FailDialog("获取手机验证码太频繁！")}else{a();c.FailDialog("验证码发送失败["+d.state+"]！")}}c.isLoaded=true})}else{if(c.identityType=="1"){GetJPData(c.passportUrl,"sendCodeEmailVcCode","userEmail="+c.identityVal+"&auth="+$.vcCode4Mobile.options.authstr,function(d){if(d.state==0){b();c.OKDialog("验证邮件已发送，请查收！");c.$btnSubmit.attr("class","orgBtn")}else{if(d.state==2){a();c.FailDialog("获取邮件验证码太频繁！")}else{a();c.FailDialog("验证码发送失败["+d.state+"]！")}}c.isLoaded=true})}}},submitSaveData:function(){var b=this;if(!b.isLoaded){return}if(b.$btnSubmit.hasClass("grayBtn")){return false}var a=b.codeObj.val();if(a==""){b.FailDialog(b.codeErr.Empty);return false}else{if(!b.isDigitLetter(a)){b.FailDialog(b.codeErr.LenErr);return false}}b.isLoaded=false;if(b.identityType=="0"){GetJPData(b.passportUrl,"verifyorgmobilesn","sn="+a,function(c){if(c.state==0){if(b.isOpen){b.closeUserPayPwdFun(c.str)}else{location.href="PayPwdSet.do?sn="+c.str+"&forward="+$("#hidForward").val()}}else{b.FailDialog(b.codeErr.Err)}b.isLoaded=true})}else{if(b.identityType=="1"){GetJPData(b.passportUrl,"verifyEmailSN","sn="+a+"&userEmail="+b.identityVal,function(c){if(c.state==0){if(b.isOpen){b.closeUserPayPwdFun(c.str)}else{location.href="PayPwdSet.do?sn="+c.str+"&forward="+$("#hidForward").val()}}else{if(c.state==2){b.FailDialog("验证码错误次数过多，请重新获取！")}else{if(c.state==10){location.reload()}else{if(c.state==-1){b.FailDialog("验证码已失效，请重新发送！")}else{b.FailDialog(b.codeErr.Err)}}}}b.isLoaded=true})}}},};$(document).ready(function(){Base.getScript("https://skin.1yyg.net/Plugins/ygVcCode/jquery.vcCode4Mobile.js",function(){Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",Wx.PayPwdCheckFun.init())})});