$(function(){var a=false;var b=function(){var E=parseInt($("#hidShopMoney").val());var p=parseInt($("#hidBrokerage").val());var q=parseInt($("#hidBalance").val());var z=parseInt($("#hidPoints").val());var e=$("#hidPayBrokerage");var x=$("#hidPayPoints");var C=$("#hidPaylBalance");var O=$("#hidPayBank");var v=$("div.other_pay").children("a");var J=$("<a></a>");var B=$(v[0]);var g=$(v[1]);var j=$(v[2]);if(p>=1){J=$(v[0]);B=$(v[1]);g=$(v[2]);j=$(v[3])}var m=$("div.net-pay");var c=$("#hidIsBuyNext").val();var y=function(R){$.PageDialog.fail(R)};var D=function(S,R){$.PageDialog.ok(S,R)};var f=function(R){if(R>0){e.val(R);J.addClass("checked").find("em.orange").html("-<b>￥</b>"+R.toFixed(2))}else{e.val("0");J.removeClass("checked").find("em.orange").html("")}};var I=function(R){if(R>0){x.val(R);B.addClass("checked").find("em.orange").html("-<b>￥</b>"+R.toFixed(2))}else{x.val("0");B.removeClass("checked").find("em.orange").html("")}};var w=function(R){if(R>0){C.val(R);g.addClass("checked").find("em.orange").html("-<b>￥</b>"+R.toFixed(2))}else{C.val("0");g.removeClass("checked").find("em.orange").html("")}};var H=function(R){if(R>0){O.val(R);j.addClass("checked").find("em.orange").html('<span class="colorbbb">需要支付&nbsp;</span><b>￥</b>'+R.toFixed(2));j.next("div.net-pay").show()}else{O.val("0");j.removeClass("checked").find("em.orange").html("");j.next("div.net-pay").hide()}};var G=parseInt(z/100);var M=function(){var R=E;if(p>0){if(p>=R){f(R);I(0);w(0);H(0)}else{f(p);R=R-p;if(G>=R){I(R);w(0);H(0)}else{I(G);R=R-G;if(q>=R){w(R);H(0)}else{w(q);H(R-q)}}}}else{f(0);if(G>=R){I(R);w(0);H(0)}else{I(G);R=R-G;if(q>=R){w(R);H(0)}else{w(q);H(R-q)}}}};var P=function(){var T=parseInt(e.val());var R=parseInt(x.val());var S=parseInt(C.val());var U=parseInt(O.val());var V=(T+R+S+U)>=E;if(V){Q.removeClass("grayBtn").unbind("click").bind("click",F)}else{Q.addClass("grayBtn").unbind("click")}};var i=0;var N=$(".g-pay-lst").children("ul").find("li");var n=N.length;var d=$(".g-pay-lst").children("ul").height();var r=function(){if(i==0){$(".g-pay-lst").children("ul").css("height","auto");i=1;$(this).removeClass("pay_pack")}else{$(".g-pay-lst").children("ul").css("height",d);i=0;$(this).addClass("pay_pack")}};if(n>3){var o=$("#a_exp");if(o.length>0){$("#a_exp").bind("click",r)}}var A=function(R){var T=B.hasClass("checked");var S=g.hasClass("checked");if(T){if(G>=R){I(R);w(0);R=0}else{I(G);R=R-G}}if(S){if(q>=R){w(R);R=0}else{w(q);R=R-q}}H(R)};J.bind("click",function(S){if(a){return}stopBubble(S);if(p<=0){y("佣金不足支付");return}var T=J.hasClass("checked");var R=E;if(!T){if(p>=R){f(R);I(0);w(0);H(0)}else{f(p);R=R-p;A(R)}}else{f(0);A(R)}P()});var u=function(R){var T=J.hasClass("checked");var S=g.hasClass("checked");if(T){if(p>=R){f(R);w(0);R=0}else{f(p);R=R-p}}if(S){if(q>R){w(R);R=0}else{w(q);R=R-q}}H(R)};B.bind("click",function(S){if(a){return}stopBubble(S);if(G<=0){y("福分不足支付");return}var T=B.hasClass("checked");var R=E;if(!T){if(G>R){I(R);f(0);w(0);H(0)}else{I(G);R=R-G;u(R)}}else{I(0);u(R)}P()});var l=function(R){var T=J.hasClass("checked");var S=B.hasClass("checked");if(T){if(p>=R){f(R);R=0}else{f(p);R=R-p}}if(S){if(G>R){I(R);R=0}else{I(G);R=R-G}}H(R)};g.bind("click",function(T){if(a){return}stopBubble(T);if(q<=0){y("余额不足支付");return}var R=E;var S=g.hasClass("checked");if(!S){if(q>R){w(R);f(0);I(0);H(0)}else{w(q);R=R-q;l(R)}}else{w(0);l(R)}P()});j.bind("click",function(T){if(a){return}stopBubble(T);var S=E-parseInt(e.val())-parseInt(x.val())-parseInt(C.val());var R=j.hasClass("checked");if(!R){H(S)}else{H(0)}P()});$("div.net-pay").children("a").each(function(){var R=$(this);R.click(function(){R.addClass("checked").siblings().removeClass("checked")})});M();var k=function(Y,S,T,R,aa){var U=255;var X=130;if(typeof(R)!="undefined"){U=R}if(typeof(R)!="undefined"){X=aa}var Z=null;var ab='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+Y+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">重试</a></div></div></div>';var W=function(){var ac=$("#pageDialog");ac.find("a.z-DefineBtn").click(function(){V.close();if(typeof(S)!="undefined"&&S!=null){S()}});ac.find("a.z-CloseBtn").click(function(){V.cancel();if(typeof(T)!="undefined"&&T!=null){T()}})};var V=new $.PageDialog(ab,{W:U,H:X,close:true,autoClose:false,ready:W})};var L=function(S){var R=function(V,W,T){var U=new RegExp(W,"g");return V.replace(U,T)};var S=escape(S);S=R(S,"\\+","%2B");S=R(S,"/","%2F");return S};var h=["","","","","","",""];var t;var s=function(U){var aa=0;var W;var Y=function(ac,ab){return Math.random()>0.5?-1:1};var R=function(){var ac='<div class="pop-pay-pwd clearfix">';ac+="<dl>";ac+='<dt class="gray3">请输入支付密码</dt>';ac+='<dd id="ddpwd">';ac+="<span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span><span><em></em></span>";ac+="</dd>";ac+="</dl>";ac+='<ul class="pop-pay-pwd clearfix" id="input_pwd">';var ae=[];for(var ad=0;ad<10;ad++){ae[ad]='<li type="num"><a href="javascript:;">'+ad+"</a></li>"}var af=ae.sort(Y);var ab=af.length-1;var ag=af[ab];af.splice(ab,1,'<li><a id="a_close" >关闭</a></li>',ag);ac+=af.join("");ac+='<li><a id="a_del" >清除</a></li>';ac+="</ul>";ac+="</div>";return ac};var Z=function(){if(/^\d{6}$/.test(h.join(""))){if(typeof(U)!="undefined"&&U!=null){U();return true}}return false};var X;var S=function(ab){if(aa>5){return false}var ac=parseInt(ab.text());if(ac>=0&&ac<10){X.eq(aa).html("●");h[aa]=ac;aa++}Z()};var T=function(){payFun.resetFun()};var V=function(){t=$("#pageDialog");var ac=$("#a_close",t);var ab=$("#a_del",t);X=$("#ddpwd",t).find("em");payFun.resetFun();$("#input_pwd",t).children('li[type="num"]').each(function(){$(this).bind("click",function(){S($(this))})});ac.click(function(){W.cancel()});ab.click(function(){T()})};this.closeFun=function(){if(W){W.close()}};this.initFun=function(){var ac=$(document.body).width()>900?900:$(document.body).width();var ab=ac*0.8;W=new $.PageDialog(R(),{W:ab,H:335,close:true,autoClose:false,ready:V})};this.resetFun=function(){aa=0;$(h).each(function(ab){h[ab]="";X.eq(ab).html("")})}};var Q=$("#btnPay");var K=function(R,S){if(R){a=false;Q.bind("click",F).removeClass("grayBtn").html("立即支付")}else{a=true;Q.addClass("grayBtn").html(S).unbind("click")}};var F=function(){if(a){return}if(E<=0){alert("亲，您的购物车中没有商品哦，去选购一些吧");location.replace("/"+Gobal.SiteVer+"/mycart/index.do");return}var S=parseInt(e.val());var X=parseInt(x.val());var Y=parseInt(C.val());var U=parseInt(O.val());var T=j.hasClass("checked");var Z=m.children("a.checked").attr("id");var R=(J.hasClass("checked")||B.hasClass("checked")||g.hasClass("checked"))&&!T;if(!R&&!T){y("请选择支付方式");return}if((X+Y+U+S)!=E){y("提交失败[支付金额错误]");return}K(false,'正在请求,请稍等<span class="dotting"></span>');var W=function(){if(Y>0||X>0||S>0){var ab=function(){var ac=function(){var ae=h.join("");if(ae.length==6){payFun.closeFun();var ad=function(ah){if(ah.state==0||ah.state==-4){V(ah.str)}else{if(ah.state==1){if(ah.num==-4){y("密码错误次数超限，已冻结！")}else{var ag=function(){payFun.closeFun();K(true,"立即支付")};var af=function(){payFun.initFun()};k("支付密码错误，还可输入"+ah.str+"次！",af,ag)}}else{y("支付异常,请刷新重试[2]！");K(true,"立即支付")}}};GetJPData("https://passport.1yyg.com","checkUPaypwd","paypwd="+ae,ad)}};payFun=new s(ac);payFun.initFun()};var aa=function(ac){if(ac.state==0){V("")}else{if(ac.state==1){ab()}else{if(ac.state==-4||ac.state==10){location.reload()}else{y("支付异常,请刷新重试[1]！")}}K(true,"立即支付")}};GetJPData("https://passport.1yyg.com","checkUPay","broker="+S+"&point="+(X*100)+"&isBalance="+(Y>0?1:0),aa)}else{V("")}};var V=function(ac){if(R){var ab=function(ae){var ad=function(af){if(af.state==0){location.replace("/"+Gobal.SiteVer+"/mycart/shopok.do?id="+af.str);return}else{if(af.state==1||af.state==4){D("已抢光啦，您下手太慢了噢！",function(){location.reload()})}else{D("提交失败，请重试！",function(){location.reload()})}}a=false;Q.bind("click",F).removeClass("grayBtn").html("立即支付")};$.getJSON("https://trade.1yyg.com/JPData/API.ashx?action=UserPay&id="+ae+"&broker="+S+"&integral="+(X*100)+"&isBalance="+(Y>0?1:0)+"&device=3&checkSN="+ac+"&isBuyNext="+c+"&fun=?",ad)};var aa=function(ad){if(ad.code==0){ab(ad.id)}else{alert("请求失败[code:"+ad.code+"]");location.reload()}};a=true;K(false,'正在提交支付,请稍等<span class="dotting"></span>');GetJPData(Gobal.WxDomain,"getnewcartid","",aa)}else{if(Z!=""){a=true;K(false,'正在提交支付,请稍等<span class="dotting"></span>');location.href="GoPay.do?payname="+Z+"&useBalance="+(Y>0?1:0)+"&broker="+S+"&integral="+(X*100)+"&checkSN="+ac+"&isBuyNext="+c;setTimeout(function(){K(true,"立即支付")},5000)}else{y("请选择支付方式");K(true,"立即支付")}}};W()};Q.bind("click",F)};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/AntiTip.js?date=170428",function(){var c=new CheckAntiApi(b,1);c.check()})})});