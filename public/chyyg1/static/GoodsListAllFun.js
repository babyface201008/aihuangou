$(function(){var c=15;var f=null;var a=$("#ulGoodsList");var d=$("#hdSortID"),k=$("#hdOrderFlag");var b=$("#divLoading"),j=$(".load_more");var h=false;var e=20;var i=0;var g={sortID:d.val(),brandID:$("#hdBrandID").val(),nvgID:0,preview:0,orderFlag:k.val(),FIdx:1,EIdx:e,isCount:1};if(!Gobal.IsWeixin){$("body").addClass("m-site-box")}var l=function(){var r=$(".good-list-box");var x=r.find(".goodList");var v=function(){var A=$("#divSortList"),B=A.find("ul");B.on("click","li",function(){var I=$(this);var F=I.index();var E=I.height();I.addClass("current").siblings().removeClass("current");A.stop().animate({scrollTop:F*E},500);g.sortID=I.attr("sortid");g.nvgID=I.attr("sortid");var H=I.attr("reletype");if(H==3){var G=I.attr("linkaddr");window.location.href=G}else{g.orderFlag=10;D.find("li[orderflag=10]").addClass("current").siblings().removeClass("current");if(C){f.getInitPage()}else{C=true}}});var D=$("#ulOrderBy");D.on("click","li",function(){var F=$(this);F.addClass("current").siblings().removeClass("current");var E=F.attr("orderflag");g.orderFlag=E;if(F.index()==3){if(E==30){F.attr("orderflag",31);F.find("i:eq(1)").addClass("sort").siblings().removeClass("sort")}else{F.attr("orderflag",30);F.find("i:eq(0)").addClass("sort").siblings().removeClass("sort")}}else{F.parent().find("i").removeClass("sort")}f.getInitPage()});var C=true;if(d.val()!="0"){if(d.val()=="400"){C=false}B.find("li[sortid="+d.val()+"]").trigger("click")}if(k.val()!="10"){D.find("li[orderflag="+k.val()+"]").addClass("current").siblings().removeClass("current")}};v();var w=new $CartComm();var u=function(A){$.PageDialog('<div class="Prompt">'+A+"</div>",{W:150,H:45,close:false,autoClose:true,submit:function(){location.reload()}})};var n=function(A){$.PageDialog.fail(A)};var t=function(A){$.PageDialog.ok(A)};var z=function(H,B,C,A,J){var D=255;var G=126;if(typeof(A)!="undefined"){D=A}if(typeof(A)!="undefined"){G=J}var I=null;var K='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+H+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var F=function(){var L=$("#pageDialog");L.find("a.z-DefineBtn").click(function(){if(typeof(B)!="undefined"&&B!=null){B()}E.close()});L.find("a.z-CloseBtn").click(function(){if(typeof(C)!="undefined"&&C!=null){C()}E.cancel()})};var E=new $.PageDialog(K,{W:D,H:G,close:true,autoClose:false,ready:F})};var s=function(){var A=function(){return"sortID="+g.sortID+"&brandID="+g.brandID+"&nvgID="+g.nvgID+"&preview="+g.preview+"&orderFlag="+g.orderFlag+"&FIdx="+g.FIdx+"&EIdx="+g.EIdx+"&isCount="+g.isCount};var B=function(G,F,D,E){G.addClass("add");w.addShopCart(F,D,function(H){if(H.code==0){addNumToCartFun(H.num);t("添加成功")}else{if(H.code==2){n("哎呀！购物车满啦，删除一些吧！",300)}else{n("添加失败，请重试["+H.code+"]")}}G.removeClass("add")},E)};var C=function(){b.show();GetJPData("","getGoodsPageList",A(),function(L){if(L.code==0){var I=L.listItems;if(g.isCount==1){i=L.count;g.isCount=0}var M=I.length;var N=0;var P=0;var E=0;var R=0;var G,K,D;for(var J=0;J<M;J++){var H=I[J];var F=parseInt(H.codeType);N=parseInt(H.codeSales);P=parseInt(H.codeQuantity);E=parseInt(P-N);R=parseInt(N*100)/P;R=N>0&&R<1?1:R;_CanBuy=E;if(F==3){_CanBuy=H.codeLimitBuy>=E?E:H.codeLimitBuy}K="";if(H.goodsTag==10){K='<div class="pTitle pPurchase"><span>限购<span></div>'}D="";if(E==0){D="unAdd"}G='<li id="'+H.goodsID+'">    <span class="gList_l fl">        <img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/GoodsPic/pic-200-200/'+H.goodsPic+'" />'+K+'    </span>    <div class="gList_r">        <h3 class="gray6">(第'+H.codePeriod+"云)"+H.goodsSName+'</h3>        <em class="gray9">价值：￥'+CastMoney(H.codePrice)+'</em>        <div class="gRate">            <div class="Progress-bar">                <p class="u-progress"><span style="width: '+R+'%;" class="pgbar"><span class="pging"></span></span></p>                <ul class="Pro-bar-li">                    <li class="P-bar01"><em>'+N+'</em>已参与</li>                    <li class="P-bar02"><em>'+P+'</em>总需人次</li>                    <li class="P-bar03"><em>'+E+'</em>剩余</li>                </ul>            </div>            <a codeid="'+H.codeID+'" class="'+D+'" canbuy="'+_CanBuy+'"><s></s></a>        </div>    </div></li>';var O=$(G);O.click(function(){location.href="/"+Gobal.SiteVer+"/products/"+$(this).attr("id")+".do"}).find("div.gRate").find("a").click(function(T){stopBubble(T);var S=$(this);if(!S.hasClass("unAdd")){B(S,S.attr("codeid"),1,S.attr("canbuy"))}});a.append(O)}b.hide();if(g.EIdx<i){h=false}else{h=true}o(0)}else{if(L.code==-1){if(g.FIdx==1){h=true;var Q='<div class="wx1yyg-kylin-norecords"><i class="wx1yyg-kylin-icon kylin-null-06"></i><strong class="gray9">该类商品即将上架哦~</strong></div>';a.html(Q)}b.hide()}else{n("加载失败，请重试["+L.code+"]！")}}})};this.getInitPage=function(){g.FIdx=1;g.EIdx=e;g.isCount=1;i=0;a.empty();C()};this.getFirstPage=function(){C()};this.getNextPage=function(){g.FIdx+=e;g.EIdx+=e;C()}};f=new s();var m=$("#hdIsPreview").val()==1?true:false;if(m===true){g.nvgID=$("#hdNvgtID").val();g.preview=1;f.getInitPage()}else{f.getFirstPage()}var y=$("#li_top");y.bind("click",function(){$(this).hide();r.stop().animate({scrollTop:0},500)});var q=function(B){var A=r.height();r.scroll(function(){var C=x.height();var D=r.scrollTop()+A;if(C-D<=A*4){if(!h&&B){h=true;B()}}if(r.scrollTop()>100){y.show()}else{y.hide()}})};q(f.getNextPage);var o=function(C){var B=$("#loadingPicBlock");if(B.length>0){var I="src2";Gobal.LoadImg=B.find("img["+I+"]");var A=function(){return r.scrollTop()};var E=function(){return r.height()+A()+50};var H=function(){Gobal.LoadImg.each(function(J){if($(this).offset().top<=E()){var K=$(this).attr(I);if(K){$(this).attr("src",K).removeAttr(I).show()}}})};var D=0;var F=-100;var G=function(){D=A();if(D-F>50){F=D;H()}};if(C==0){r.bind("scroll",G)}G()}};var p=function(){var G=$("#divSearch"),E=G.find("input"),C=$(".history");var B={boxShow:function(){G.addClass("focus-box");$(".search-info").show();$(".all-list-wrapper").hide();$(".footer").hide()},boxHide:function(){G.removeClass("focus-box");$(".search-info").hide();$(".all-list-wrapper").show();$(".footer").show()},setHash:function(){if(document.location.hash==""){this.boxHide();E.blur()}else{if(document.location.hash="#sbox"){this.boxShow()}}}};if(document.location.hash==="#sbox"){B.boxShow()}E.on("focus",function(){document.location.hash="#sbox"});$(window).on("hashchange",function(){B.setHash()});Array.prototype.remove=function(I){var H=this.indexOf(I);if(H>-1){this.splice(H,1)}};var F={searchData:[],add:function(H){if(H==null||H==undefined||H==""){return}this.del(H);var I="";this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){I=H+","+this.searchData;this.searchData=I.split(",");if(this.searchData.length>c){this.searchData.splice(c,1)}I=this.searchData.toString()}else{I=H}window.localStorage.setItem("searchData",I)},del:function(I){this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){var H=this.searchData.split(",");if(H.length>0&&H.indexOf(I)>-1){H.remove(I);window.localStorage.setItem("searchData",H.toString())}}},clear:function(){delete localStorage.searchData},get:function(){this.searchData=window.localStorage.searchData},fresh:function(L){this.searchData=window.localStorage.searchData;if(this.searchData!=undefined&&this.searchData.length>0){var H=this.searchData.split(","),I="",M='<ul class="his-list thin-bor-top">',K="";for(var J=0;J<H.length;J++){K+='<li wd="'+H[J]+'" class="thin-bor-bottom"><a class="items">'+H[J]+"</a></li>"}if(K!=""){I=M+K+"</ul>";I+='<div class="cle-cord thin-bor-bottom" id="btnClear">清空历史记录</div>';L.on("click","li",function(){var O=$(this),N=O.attr("wd");F.add(N);F.fresh(L);location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+N});L.on("click","#btnClear",function(){F.clear();F.fresh(L)});L.html(I);C.show()}}else{L.html("");C.hide()}}};var D=$("#divSearchHotHistory"),A=$("#btnClearInput");F.fresh(D);$("#ulSearchHot").on("click","li",function(){var I=$(this),H=I.attr("wd");F.add(H);location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+H});$("#btnSearch").click(function(){var H=E.val();F.add(H);if(H==""){H="汽车"}location.href="/"+Gobal.SiteVer+"/GoodsSearch.do?q="+H});E.bind("input",function(){if($(this).val()==""){A.hide()}else{A.show()}});A.bind("click",function(){E.val("").focus();$(this).hide()})};p()};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/fastclick.js?v=160523",l)})});