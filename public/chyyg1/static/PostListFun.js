$(function(){if(!Gobal.IsWeixin){$(".m-block-header").show();$(".column-wrapper").addClass("m-site-column ");$("#divSortMenu").addClass("m-site-tail")}var k=$("#divPostList");var f=$("#postLoading");var h=40;var g=null;var i={FIdx:1,EIdx:h,isCount:1,OrderFlag:10,SortID:0};$("#Topnav").find("li").each(function(){var l=$(this);l.click(function(){l.addClass("current").siblings().removeClass("current");i.OrderFlag=parseInt(l.attr("order"));g.initData()})});var j=false;var d=$("#divSortMenu");d.find("li").each(function(){var l=$(this);l.click(function(){var m=l.text();if(m!=""){l.addClass("current").siblings().removeClass("current");i.SortID=parseInt(l.attr("sortid"));e();b.html('<a href="javascript:;" class="column">'+m+"<span></span></a>");g.initData()}})});var e=function(){b.removeClass("current");d.hide();j=false;a.hide();$("body").attr("style","");IsMasked=false};var b=$("#Topnav").find("div.wx-nav-menu");var a=$("div.weixin-mask");b.click(function(l){stopBubble(l);if(j){e()}else{$(this).addClass("current");d.show();j=true;$("body").attr("style","overflow:hidden;");a.css("height",$(document).height()>$(window).height()?$(document).height():$(window).height()).show();IsMasked=true}});$("body").click(function(){e()});var c=function(){var m=0;var l=function(){var o="FIdx="+i.FIdx+"&EIdx="+i.EIdx+"&isCount="+i.isCount+"&order="+i.OrderFlag+"&sortID="+i.SortID;return o};var n=function(){GetJPData("","getPostPageList",l(),function(w){if(w.code==0){if(i.isCount==1){m=w.count;i.isCount=0}var t=w.listItems;for(var x=0;x<t.length;x++){var B="";var y="";var u=t[x].postID;if(k.find('.show-list[postid="'+u+'"]').length>0){continue}if(t[x].isRecommend==0){var z=t[x].postAllPic.split(",");y="https://img.1yyg.net/userpost/small/"+z[0];for(var v=0;v<z.length;v++){B+='<li><img src="'+Gobal.LoadPic+'" src2="https://img.1yyg.net/userpost/small/'+z[v]+'"></li>';if(v>=2){break}}}else{y="https://img.1yyg.net/userpost/RecHome/"+t[x].postPic;B='<li><img src="'+Gobal.LoadPic+'" src2="'+y+'"></li>'}var o='<div class="show-list" postid="'+u+'"><div class="show-head"><a href="/'+Gobal.SiteVer+"/userpage/"+t[x].userWeb+'" class="show-u blue">'+t[x].userName+'</a><span class="show-time">'+t[x].postTime+'</span></div><a href="/'+Gobal.SiteVer+"/post/detail-"+u+'.do"><h3>'+t[x].postTitle+'</h3></a><a href="/'+Gobal.SiteVer+"/post/detail-"+u+'.do"><div class="show-pic"><ul class="'+(t[x].isRecommend==0?"pic-more":"pic-one")+' clearfix">'+B+'</ul></div><div class="show-con"><p name="content">'+t[x].postContent+'</p></div></a><div class="opt-wrapper"><ul class="opt-inner"><li name="wx_talk" postID="'+t[x].postID+'"><a href="javascript:;"><span class="talk wx-new-icon"></span><em>'+t[x].postReplyCount+'</em></a></li><li name="wx_zan" postID="'+t[x].postID+'"><a href="javascript:;"><span class="zan wx-new-icon"></span><em>'+t[x].postHits+"</em></a></li></ul></div></div>";var s=$(o);s.find('li[name="wx_share"]').click(function(){var F=$(this).attr("postTitle");var E=$(this).attr("postContent");var D=$(this).attr("postID");var C=$(this).attr("postImg");if(Gobal.IsWeixin){wxShareFun({shareTitle:[""+F+""],shareImg:C,shareLink:Gobal.WxDomain+"/"+Gobal.SiteVer+"/post/detail-"+D+".do",shareDesc:E});wxShowMaskFun()}else{mShareTools.InitialSettings({sTitle:[""+F+""],sImg:C,sUrl:Gobal.WxDomain+"/"+Gobal.SiteVer+"/post/detail-"+D+".do",sDesc:E});mShareTools.ShowShare()}});s.find('li[name="wx_talk"]').click(function(){location.href="/"+Gobal.SiteVer+"/post/detail-"+$(this).attr("postID")+".do"});var q=s.find('li[name="wx_zan"]');var A="postHits";var r=$.cookie(A);if(r==null||r==""){r=","}if(r.indexOf(","+q.attr("postID")+",")>=0){q.addClass("current")}else{var p=function(D,C){GetJPData("","InsertPostHits","postid="+C,function(F){if(F.code==0){r=r+C+",";$.cookie(A,r,{expires:1,path:"/"});E(D)}});var E=function(I){var L=I.find("span");var F=20;var H=18;var J=-2;var M=-1;var G=parseInt(I.find("em").html());var K=$('<img style="display: none" src="https://skin.1yyg.net/v1/weixin/post/images/xin-big.png?v=151030" />').prependTo(L);K.css({position:"absolute",left:J+"px",top:M+"px",width:F,height:H,"z-index":9999}).show();K.animate({width:F*2,height:H*2,left:J-F/2,top:M-H/2,opacity:0},700,function(){K.remove();I.addClass("current").find("em").html(G+1)})}};q.bind("click",function(){var C=$(this).attr("postID");if(r.indexOf(","+C+",")>=0){return}p($(this),C)})}k.append(s)}if(i.EIdx<m){_IsLoading=false}else{_IsLoading=true;f.hide()}loadImgFun(0)}else{f.hide();if(i.FIdx==1){_IsLoading=true;k.html(Gobal.NoneHtml)}}})};this.initData=function(){i.FIdx=1;i.EIdx=h;i.isCount=1;k.empty();n()};this.getNextPage=function(){i.FIdx+=h;i.EIdx+=h;n()}};g=new c();Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/WxShare.js?v=170329",g.initData)});scrollForLoadData(g.getNextPage)});